
<!--
# ЛІЦЕНЗІЙНИЙ ДОГОВІР/LICENSE AGREEMENT (Ukrainian/English(bellow))
# ЛІЦЕНЗІЙНИЙ ДОГОВІР
Цей ліцензійний договір (далі — "Договір") є юридично обов’язковою угодою між Вами (далі — "Користувач") та Богданом-Любомиром Тетяничем-Бубликом (далі — "Ліцензіар") щодо використання програмного забезпечення (TETRAquantSimulator) (далі — "Програмне забезпечення").

---
## 1. Предмет договору
1.1. Ліцензіар надає Користувачу невиключну, обмежену ліцензію на використання Програмного забезпечення відповідно до умов цього Договору.    
1.2. Програмне забезпечення залишається виключною власністю Ліцензіара.

---
## 2. Права Користувача
2.1. Користувач має право:

- Використовувати Програмне забезпечення для особистих або професійних цілей.
- Аналізувати вихідний код Програмного забезпечення (якщо він наданий).

---
## 3. Обмеження
3.1. Користувач не має права:

- Передавати, розповсюджувати, продавати, здавати в оренду, або надавати доступ до Програмного забезпечення без письмової згоди Ліцензіара.
- Використовувати Програмне забезпечення для створення похідних продуктів без згоди Ліцензіара.

---
## 4. Відповідальність
4.1. Ліцензіар не несе відповідальності за будь-які прямі або непрямі збитки, завдані внаслідок використання Програмного забезпечення.  
4.2. Програмне забезпечення надається "як є", без жодних гарантій щодо його працездатності або відповідності конкретним цілям.

---
## 5. Захист інтелектуальної власності
5.1. Усі права на Програмне забезпечення, включаючи, але не обмежуючись, авторськими правами та комерційними таємницями, залишаються за Ліцензіаром.

---
## 6. Припинення дії Договору
6.1. Цей Договір діє до моменту його припинення.  
6.2. Ліцензіар може припинити дію Договору в разі порушення Користувачем будь-яких умов цього Договору.

---
## 7. Інші положення
7.1. Цей Договір регулюється чинним законодавством України.  
7.2. Усі спори, що виникають у зв’язку з цим Договором, вирішуються шляхом переговорів, а в разі неможливості досягнення згоди — у відповідному суді.

Підписуючи або встановлюючи/використовуючи Програмне забезпечення, Ви підтверджуєте, що ознайомилися з умовами цього Договору та погоджуєтеся з ними.

**Богдан-Любомир Тетянич-Бублик**  
Дата: 2024.11.16

---
---
---
## LICENSE AGREEMENT
This License Agreement (hereinafter referred to as the "Agreement") is a legally binding agreement between you (hereinafter referred to as the "User") and Tetianych-Bublyk Bohdan-Liubomyr (hereinafter referred to as the "Licensor") regarding the use of the software(TETRAquantSimulator) (hereinafter referred to as the "Software").

---
## 1. Subject of the Agreement
1.1. The Licensor grants the User a non-exclusive, limited license to use the Software under the terms of this Agreement.  
1.2. The Software remains the exclusive property of the Licensor.

---
## 2. User Rights
2.1. The User is entitled to:

- Use the Software for personal or professional purposes.
- Analyze the source code of the Software (if provided).

---
## 3. Restrictions
3.1. The User is prohibited from:

- Transferring, distributing, selling, renting, or granting access to the Software without the prior written consent of the Licensor.
- Using the Software to create derivative works without the Licensor's consent.

---
## 4. Liability
4.1. The Licensor shall not be held liable for any direct or indirect damages resulting from the use of the Software.  
4.2. The Software is provided "as is," without any guarantees of functionality or suitability for specific purposes.

---
## 5. Intellectual Property Protection
5.1. All rights to the Software, including but not limited to copyrights and trade secrets, remain with the Licensor.

---
## 6. Termination of the Agreement
6.1. This Agreement shall remain in effect until terminated.  
6.2. The Licensor may terminate this Agreement if the User violates any terms of this Agreement.

---
## 7. Miscellaneous Provisions
7.1. This Agreement shall be governed by the laws of Ukraine.  
7.2. Any disputes arising from this Agreement shall be resolved through negotiations. If no resolution is reached, disputes shall be settled in the appropriate court.

By signing or installing/using the Software, you confirm that you have read and agree to the terms of this Agreement.

**Tetianych-Bublyk Bohdan-Liubomyr**    
Date: 2024.11.16 -->
<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tetra Path Finder</title>
    <style>
        canvas {
            border: 1px solid black;
            display: block;
            margin: 10px auto;
            touch-action: none;
        }
        .controls {
            text-align: center;
            margin: 10px 0;
        }
        .btn {
            padding: 8px 15px;
            margin: 0 5px;
            cursor: pointer;
            border: none;
            border-radius: 4px;
            font-size: 14px;
        }
        .btn-yellow {
            background-color: #FFD700;
            color: black;
        }
        .btn-blue {
            background-color: #0000FF;
            color: white;
        }
        .btn-black {
            background-color: #000000;
            color: white;
        }
        .btn-go {
            background-color: #32CD32;
            color: white;
        }
        .active {
            box-shadow: 0 0 5px #666;
            transform: scale(1.1);
        }
      .btn-und {
    background-color: #FF4500; /* Яскраво червоний */
    color: white;
    border: 2px solid #FF6347; /* Світліший червоний */
    border-radius: 8px; /* Закруглені краї */
    font-size: 16px; /* Більший текст */
    font-weight: bold;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2); /* Тінь */
    transition: transform 0.2s, background-color 0.3s; /* Анімація */
}
          /* Стиль кнопки */
#download-btn {
    background: linear-gradient(180deg, #ffcc00, #0072ce); /* Чистий жовто-блакитний вертикальний градієнт */
    border: none;
    color: #ffffff; /* Білий текст */
    font-size: 20px;
    text-transform: uppercase;
    letter-spacing: 1.5px; /* Більший інтервал між літерами */
    padding: 15px 30px;
    cursor: pointer;
    position: relative;
    box-shadow: 4px 4px 15px rgba(0, 0, 0, 0.3), -4px -4px 15px rgba(255, 255, 255, 0.3);
    border-radius: 0; /* Різкі кути */
    transition: transform 0.3s ease, box-shadow 0.3s ease, background 0.3s ease;
    font-family: 'Arial', sans-serif;
    font-weight: bold; /* Жирний текст */
}

        /* Ефект при наведенні на кнопку */
        #download-btn:hover {
            background-color: #45a049; /* Трохи темніший зелений */
            box-shadow: 0 6px 8px rgba(0, 0, 0, 0.4); /* Більша тінь */
            transform: translateY(-2px); /* Підйом кнопки */
        }

        /* Ефект при натисканні */
        #download-btn:active {
            background-color: #3e8e41; /* Ще темніший зелений */
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3); /* Менша тінь */
            transform: translateY(1px); /* Зниження кнопки */
        }
    #download-btn {
            margin-top: 100px; /* Відступ знизу 20px */
        }
  #navigate-btn {
    background: linear-gradient(180deg, #28a745, #218838); /* Зелено-блакитний градієнт */
    border: none;
    color: #ffffff; /* Білий текст */
    font-size: 20px;
    text-transform: uppercase;
    letter-spacing: 1.5px; /* Більший інтервал між літерами */
    padding: 15px 30px;
    cursor: pointer;
    position: relative;
    box-shadow: 4px 4px 15px rgba(0, 0, 0, 0.3), -4px -4px 15px rgba(255, 255, 255, 0.3);
    border-radius: 0; /* Різкі кути */
    transition: transform 0.3s ease, box-shadow 0.3s ease, background 0.3s ease;
    font-family: 'Arial', sans-serif;
    font-weight: bold; /* Жирний текст */
     margin-top: 10px; /* Відступ знизу 20px */
        display: block; /* Перетворює на блок */
    margin-left: auto; /* Автоматичний лівий відступ */
    margin-right: auto; /* Автоматичний правий відступ */
}

/* Ефект при наведенні */
#navigate-btn:hover {
    background: linear-gradient(180deg, #218838, #006d2c); /* Глибший контраст градієнта */
    transform: translateY(-3px); /* Підйом кнопки */
    box-shadow: 6px 6px 20px rgba(0, 0, 0, 0.4), -6px -6px 20px rgba(255, 255, 255, 0.4);
}

/* Ефект при натисканні */
#navigate-btn:active {
    transform: translateY(1px); /* Легкий зсув вниз */
    box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.2), -2px -2px 10px rgba(255, 255, 255, 0.2);
    background: linear-gradient(180deg, #1e7e34, #004d1a); /* Темніший градієнт */
}
    </style>
</head>
<body>
    <canvas id="canvas" width="800" height="600"></canvas>
    <div class="controls">
        <button id="blackBtn" class="btn btn-black">Чорний</button>
        <button id="yellowBtn" class="btn btn-yellow">Жовтий</button>
        <button id="blueBtn" class="btn btn-blue">Синій</button>
        <button id="goBtn" class="btn btn-go">Побіг</button>
       <button id="undoBtn" class="btn btn-und">Undo</button> <!-- Кнопка Undo -->
    </div>
    <div class="controls">
    <button id="download-btn">download this game to play offline</button>
</div>
  
    <button id="navigate-btn" onclick="window.location.href='https://github.com/svropsitam/TetraPathFinder';">How to play & License Terms</button>

     <script>
        // Base64-закодований HTML вміст
const base64HtmlContent = `PCFET0NUWVBFIGh0bWw+CjxodG1sIGxhbmc9InVrIj4KPGhlYWQ+CiAgICA8bWV0YSBjaGFyc2V0PSJVVEYtOCI+CiAgICA8bWV0YSBuYW1lPSJ2aWV3cG9ydCIgY29udGVudD0id2lkdGg9ZGV2aWNlLXdpZHRoLCBpbml0aWFsLXNjYWxlPTEuMCI+CiAgICA8dGl0bGU+VGV0cmEgUGF0aCBGaW5kZXI8L3RpdGxlPgogICAgPHN0eWxlPgogICAgICAgIGNhbnZhcyB7CiAgICAgICAgICAgIGJvcmRlcjogMXB4IHNvbGlkIGJsYWNrOwogICAgICAgICAgICBkaXNwbGF5OiBibG9jazsKICAgICAgICAgICAgbWFyZ2luOiAxMHB4IGF1dG87CiAgICAgICAgICAgIHRvdWNoLWFjdGlvbjogbm9uZTsKICAgICAgICB9CiAgICAgICAgLmNvbnRyb2xzIHsKICAgICAgICAgICAgdGV4dC1hbGlnbjogY2VudGVyOwogICAgICAgICAgICBtYXJnaW46IDEwcHggMDsKICAgICAgICB9CiAgICAgICAgLmJ0biB7CiAgICAgICAgICAgIHBhZGRpbmc6IDhweCAxNXB4OwogICAgICAgICAgICBtYXJnaW46IDAgNXB4OwogICAgICAgICAgICBjdXJzb3I6IHBvaW50ZXI7CiAgICAgICAgICAgIGJvcmRlcjogbm9uZTsKICAgICAgICAgICAgYm9yZGVyLXJhZGl1czogNHB4OwogICAgICAgICAgICBmb250LXNpemU6IDE0cHg7CiAgICAgICAgfQogICAgICAgIC5idG4teWVsbG93IHsKICAgICAgICAgICAgYmFja2dyb3VuZC1jb2xvcjogI0ZGRDcwMDsKICAgICAgICAgICAgY29sb3I6IGJsYWNrOwogICAgICAgIH0KICAgICAgICAuYnRuLWJsdWUgewogICAgICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjMDAwMEZGOwogICAgICAgICAgICBjb2xvcjogd2hpdGU7CiAgICAgICAgfQogICAgICAgIC5idG4tYmxhY2sgewogICAgICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjMDAwMDAwOwogICAgICAgICAgICBjb2xvcjogd2hpdGU7CiAgICAgICAgfQogICAgICAgIC5idG4tZ28gewogICAgICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjMzJDRDMyOwogICAgICAgICAgICBjb2xvcjogd2hpdGU7CiAgICAgICAgfQogICAgICAgIC5hY3RpdmUgewogICAgICAgICAgICBib3gtc2hhZG93OiAwIDAgNXB4ICM2NjY7CiAgICAgICAgICAgIHRyYW5zZm9ybTogc2NhbGUoMS4xKTsKICAgICAgICB9CiAgICAgIC5idG4tdW5kIHsKICAgIGJhY2tncm91bmQtY29sb3I6ICNGRjQ1MDA7IC8qINCv0YHQutGA0LDQstC+INGH0LXRgNCy0L7QvdC40LkgKi8KICAgIGNvbG9yOiB3aGl0ZTsKICAgIGJvcmRlcjogMnB4IHNvbGlkICNGRjYzNDc7IC8qINCh0LLRltGC0LvRltGI0LjQuSDRh9C10YDQstC+0L3QuNC5ICovCiAgICBib3JkZXItcmFkaXVzOiA4cHg7IC8qINCX0LDQutGA0YPQs9C70LXQvdGWINC60YDQsNGXICovCiAgICBmb250LXNpemU6IDE2cHg7IC8qINCR0ZbQu9GM0YjQuNC5INGC0LXQutGB0YIgKi8KICAgIGZvbnQtd2VpZ2h0OiBib2xkOwogICAgYm94LXNoYWRvdzogMCA0cHggNnB4IHJnYmEoMCwgMCwgMCwgMC4yKTsgLyog0KLRltC90YwgKi8KICAgIHRyYW5zaXRpb246IHRyYW5zZm9ybSAwLjJzLCBiYWNrZ3JvdW5kLWNvbG9yIDAuM3M7IC8qINCQ0L3RltC80LDRhtGW0Y8gKi8KfQogICAgICAgICNuYXZpZ2F0ZS1idG4gewogICAgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KDE4MGRlZywgIzI4YTc0NSwgIzIxODgzOCk7IC8qINCX0LXQu9C10L3Qvi3QsdC70LDQutC40YLQvdC40Lkg0LPRgNCw0LTRltGU0L3RgiAqLwogICAgYm9yZGVyOiBub25lOwogICAgY29sb3I6ICNmZmZmZmY7IC8qINCR0ZbQu9C40Lkg0YLQtdC60YHRgiAqLwogICAgZm9udC1zaXplOiAyMHB4OwogICAgdGV4dC10cmFuc2Zvcm06IHVwcGVyY2FzZTsKICAgIGxldHRlci1zcGFjaW5nOiAxLjVweDsgLyog0JHRltC70YzRiNC40Lkg0ZbQvdGC0LXRgNCy0LDQuyDQvNGW0LYg0LvRltGC0LXRgNCw0LzQuCAqLwogICAgcGFkZGluZzogMTVweCAzMHB4OwogICAgY3Vyc29yOiBwb2ludGVyOwogICAgcG9zaXRpb246IHJlbGF0aXZlOwogICAgYm94LXNoYWRvdzogNHB4IDRweCAxNXB4IHJnYmEoMCwgMCwgMCwgMC4zKSwgLTRweCAtNHB4IDE1cHggcmdiYSgyNTUsIDI1NSwgMjU1LCAwLjMpOwogICAgYm9yZGVyLXJhZGl1czogMDsgLyog0KDRltC30LrRliDQutGD0YLQuCAqLwogICAgdHJhbnNpdGlvbjogdHJhbnNmb3JtIDAuM3MgZWFzZSwgYm94LXNoYWRvdyAwLjNzIGVhc2UsIGJhY2tncm91bmQgMC4zcyBlYXNlOwogICAgZm9udC1mYW1pbHk6ICdBcmlhbCcsIHNhbnMtc2VyaWY7CiAgICBmb250LXdlaWdodDogYm9sZDsgLyog0JbQuNGA0L3QuNC5INGC0LXQutGB0YIgKi8KICAgICBtYXJnaW4tdG9wOiA2MHB4OyAvKiDQktGW0LTRgdGC0YPQvyDQt9C90LjQt9GDIDIwcHggKi8KICAgICAgICBkaXNwbGF5OiBibG9jazsgLyog0J/QtdGA0LXRgtCy0L7RgNGO0ZQg0L3QsCDQsdC70L7QuiAqLwogICAgbWFyZ2luLWxlZnQ6IGF1dG87IC8qINCQ0LLRgtC+0LzQsNGC0LjRh9C90LjQuSDQu9GW0LLQuNC5INCy0ZbQtNGB0YLRg9C/ICovCiAgICBtYXJnaW4tcmlnaHQ6IGF1dG87IC8qINCQ0LLRgtC+0LzQsNGC0LjRh9C90LjQuSDQv9GA0LDQstC40Lkg0LLRltC00YHRgtGD0L8gKi8KfQoKLyog0JXRhNC10LrRgiDQv9GA0Lgg0L3QsNCy0LXQtNC10L3QvdGWICovCiNuYXZpZ2F0ZS1idG46aG92ZXIgewogICAgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KDE4MGRlZywgIzIxODgzOCwgIzAwNmQyYyk7IC8qINCT0LvQuNCx0YjQuNC5INC60L7QvdGC0YDQsNGB0YIg0LPRgNCw0LTRltGU0L3RgtCwICovCiAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZVkoLTNweCk7IC8qINCf0ZbQtNC50L7QvCDQutC90L7Qv9C60LggKi8KICAgIGJveC1zaGFkb3c6IDZweCA2cHggMjBweCByZ2JhKDAsIDAsIDAsIDAuNCksIC02cHggLTZweCAyMHB4IHJnYmEoMjU1LCAyNTUsIDI1NSwgMC40KTsKfQoKLyog0JXRhNC10LrRgiDQv9GA0Lgg0L3QsNGC0LjRgdC60LDQvdC90ZYgKi8KI25hdmlnYXRlLWJ0bjphY3RpdmUgewogICAgdHJhbnNmb3JtOiB0cmFuc2xhdGVZKDFweCk7IC8qINCb0LXQs9C60LjQuSDQt9GB0YPQsiDQstC90LjQtyAqLwogICAgYm94LXNoYWRvdzogMnB4IDJweCAxMHB4IHJnYmEoMCwgMCwgMCwgMC4yKSwgLTJweCAtMnB4IDEwcHggcmdiYSgyNTUsIDI1NSwgMjU1LCAwLjIpOwogICAgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KDE4MGRlZywgIzFlN2UzNCwgIzAwNGQxYSk7IC8qINCi0LXQvNC90ZbRiNC40Lkg0LPRgNCw0LTRltGU0L3RgiAqLwp9CiAgICA8L3N0eWxlPgo8L2hlYWQ+Cjxib2R5PgogICAgPGNhbnZhcyBpZD0iY2FudmFzIiB3aWR0aD0iODAwIiBoZWlnaHQ9IjYwMCI+PC9jYW52YXM+CiAgICA8ZGl2IGNsYXNzPSJjb250cm9scyI+CiAgICAgICAgPGJ1dHRvbiBpZD0iYmxhY2tCdG4iIGNsYXNzPSJidG4gYnRuLWJsYWNrIj7Qp9C+0YDQvdC40Lk8L2J1dHRvbj4KICAgICAgICA8YnV0dG9uIGlkPSJ5ZWxsb3dCdG4iIGNsYXNzPSJidG4gYnRuLXllbGxvdyI+0JbQvtCy0YLQuNC5PC9idXR0b24+CiAgICAgICAgPGJ1dHRvbiBpZD0iYmx1ZUJ0biIgY2xhc3M9ImJ0biBidG4tYmx1ZSI+0KHQuNC90ZbQuTwvYnV0dG9uPgogICAgICAgIDxidXR0b24gaWQ9ImdvQnRuIiBjbGFzcz0iYnRuIGJ0bi1nbyI+0J/QvtCx0ZbQszwvYnV0dG9uPgogICAgICAgPGJ1dHRvbiBpZD0idW5kb0J0biIgY2xhc3M9ImJ0biBidG4tdW5kIj5VbmRvPC9idXR0b24+IDwhLS0g0JrQvdC+0L/QutCwIFVuZG8gLS0+CiAgICA8L2Rpdj4KICAgICAgPGJ1dHRvbiBpZD0ibmF2aWdhdGUtYnRuIiBvbmNsaWNrPSJ3aW5kb3cubG9jYXRpb24uaHJlZj0naHR0cHM6Ly9naXRodWIuY29tL3N2cm9wc2l0YW0vVGV0cmFQYXRoRmluZGVyJzsiPkhvdyB0byBwbGF5ICYgTGljZW5zZSBUZXJtczwvYnV0dG9uPgoKCgogICAgPHNjcmlwdD4KICAgICAgICBjb25zdCB3b3JrZXJDb2RlID0gYAogICAgICAgICAgICBmdW5jdGlvbiBjYWxjdWxhdGVQYXRoKHN0YXJ0LCBlbmQsIG9ic3RhY2xlcykgewogICAgICAgICAgICAgICAgZnVuY3Rpb24gaGV1cmlzdGljKGEsIGIpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gTWF0aC5hYnMoYS54IC0gYi54KSArIE1hdGguYWJzKGEueSAtIGIueSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgZnVuY3Rpb24gZ2V0TmVpZ2hib3JzKG5vZGUpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBuZWlnaGJvcnMgPSBbXTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBkaXJlY3Rpb25zID0gWwogICAgICAgICAgICAgICAgICAgICAgICB7eDogMCwgeTogMX0sIHt4OiAxLCB5OiAwfSwKICAgICAgICAgICAgICAgICAgICAgICAge3g6IDAsIHk6IC0xfSwge3g6IC0xLCB5OiAwfSwKICAgICAgICAgICAgICAgICAgICAgICAge3g6IDEsIHk6IDF9LCB7eDogLTEsIHk6IDF9LAogICAgICAgICAgICAgICAgICAgICAgICB7eDogMSwgeTogLTF9LCB7eDogLTEsIHk6IC0xfQogICAgICAgICAgICAgICAgICAgIF07CgogICAgICAgICAgICAgICAgICAgIGZvciAobGV0IGRpciBvZiBkaXJlY3Rpb25zKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG5ld1ggPSBub2RlLnggKyBkaXIueCAqIDEwOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBuZXdZID0gbm9kZS55ICsgZGlyLnkgKiAxMDsKCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChuZXdYID49IDAgJiYgbmV3WCA8IDgwMCAmJiBuZXdZID49IDAgJiYgbmV3WSA8IDYwMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGNvbGxpc2lvbiA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgb2JzdGFjbGUgb2Ygb2JzdGFjbGVzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZGlzdGFuY2UgPSBNYXRoLnNxcnQoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE1hdGgucG93KG5ld1ggLSBvYnN0YWNsZS54LCAyKSArIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBNYXRoLnBvdyhuZXdZIC0gb2JzdGFjbGUueSwgMikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkaXN0YW5jZSA8IDEwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbGxpc2lvbiA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWNvbGxpc2lvbikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5laWdoYm9ycy5wdXNoKHt4OiBuZXdYLCB5OiBuZXdZfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5laWdoYm9yczsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBjb25zdCBvcGVuU2V0ID0gW3N0YXJ0XTsKICAgICAgICAgICAgICAgIGNvbnN0IGNhbWVGcm9tID0gbmV3IE1hcCgpOwogICAgICAgICAgICAgICAgY29uc3QgZ1Njb3JlID0gbmV3IE1hcCgpOwogICAgICAgICAgICAgICAgY29uc3QgZlNjb3JlID0gbmV3IE1hcCgpOwoKICAgICAgICAgICAgICAgIGdTY29yZS5zZXQoSlNPTi5zdHJpbmdpZnkoc3RhcnQpLCAwKTsKICAgICAgICAgICAgICAgIGZTY29yZS5zZXQoSlNPTi5zdHJpbmdpZnkoc3RhcnQpLCBoZXVyaXN0aWMoc3RhcnQsIGVuZCkpOwoKICAgICAgICAgICAgICAgIHdoaWxlIChvcGVuU2V0Lmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICBsZXQgY3VycmVudCA9IG9wZW5TZXRbMF07CiAgICAgICAgICAgICAgICAgICAgbGV0IGxvd2VzdEZTY29yZSA9IGZTY29yZS5nZXQoSlNPTi5zdHJpbmdpZnkoY3VycmVudCkpOwogICAgICAgICAgICAgICAgICAgIGxldCBjdXJyZW50SW5kZXggPSAwOwoKICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMTsgaSA8IG9wZW5TZXQubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc2NvcmUgPSBmU2NvcmUuZ2V0KEpTT04uc3RyaW5naWZ5KG9wZW5TZXRbaV0pKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNjb3JlIDwgbG93ZXN0RlNjb3JlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50ID0gb3BlblNldFtpXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvd2VzdEZTY29yZSA9IHNjb3JlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudEluZGV4ID0gaTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgaWYgKE1hdGguYWJzKGN1cnJlbnQueCAtIGVuZC54KSA8IDEwICYmIE1hdGguYWJzKGN1cnJlbnQueSAtIGVuZC55KSA8IDEwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHBhdGggPSBbY3VycmVudF07CiAgICAgICAgICAgICAgICAgICAgICAgIGxldCB0ZW1wID0gY3VycmVudDsKICAgICAgICAgICAgICAgICAgICAgICAgd2hpbGUgKGNhbWVGcm9tLmhhcyhKU09OLnN0cmluZ2lmeSh0ZW1wKSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRlbXAgPSBjYW1lRnJvbS5nZXQoSlNPTi5zdHJpbmdpZnkodGVtcCkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGF0aC51bnNoaWZ0KHRlbXApOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBwYXRoOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgb3BlblNldC5zcGxpY2UoY3VycmVudEluZGV4LCAxKTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBuZWlnaGJvcnMgPSBnZXROZWlnaGJvcnMoY3VycmVudCk7CgogICAgICAgICAgICAgICAgICAgIGZvciAobGV0IG5laWdoYm9yIG9mIG5laWdoYm9ycykgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB0ZW50YXRpdmVHU2NvcmUgPSBnU2NvcmUuZ2V0KEpTT04uc3RyaW5naWZ5KGN1cnJlbnQpKSArIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgTWF0aC5zcXJ0KE1hdGgucG93KG5laWdoYm9yLnggLSBjdXJyZW50LngsIDIpICsgTWF0aC5wb3cobmVpZ2hib3IueSAtIGN1cnJlbnQueSwgMikpOwoKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbmVpZ2hib3JTdHIgPSBKU09OLnN0cmluZ2lmeShuZWlnaGJvcik7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghZ1Njb3JlLmhhcyhuZWlnaGJvclN0cikgfHwgdGVudGF0aXZlR1Njb3JlIDwgZ1Njb3JlLmdldChuZWlnaGJvclN0cikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbWVGcm9tLnNldChuZWlnaGJvclN0ciwgY3VycmVudCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnU2NvcmUuc2V0KG5laWdoYm9yU3RyLCB0ZW50YXRpdmVHU2NvcmUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZlNjb3JlLnNldChuZWlnaGJvclN0ciwgdGVudGF0aXZlR1Njb3JlICsgaGV1cmlzdGljKG5laWdoYm9yLCBlbmQpKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIW9wZW5TZXQuc29tZShwID0+IHAueCA9PT0gbmVpZ2hib3IueCAmJiBwLnkgPT09IG5laWdoYm9yLnkpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3BlblNldC5wdXNoKG5laWdoYm9yKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICB9CgogICAgICAgICAgICBzZWxmLm9ubWVzc2FnZSA9IGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHBhdGggPSBjYWxjdWxhdGVQYXRoKGUuZGF0YS5zdGFydCwgZS5kYXRhLmVuZCwgZS5kYXRhLm9ic3RhY2xlcyk7CiAgICAgICAgICAgICAgICBzZWxmLnBvc3RNZXNzYWdlKHBhdGgpOwogICAgICAgICAgICB9OwogICAgICAgIGA7CgogICAgICAgIGNvbnN0IGJsb2IgPSBuZXcgQmxvYihbd29ya2VyQ29kZV0sIHsgdHlwZTogJ2FwcGxpY2F0aW9uL2phdmFzY3JpcHQnIH0pOwogICAgICAgIGNvbnN0IHdvcmtlciA9IG5ldyBXb3JrZXIoVVJMLmNyZWF0ZU9iamVjdFVSTChibG9iKSk7CgogICAgICAgIGNvbnN0IGNhbnZhcyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjYW52YXMnKTsKICAgICAgICBjb25zdCBjdHggPSBjYW52YXMuZ2V0Q29udGV4dCgnMmQnKTsKICAgICAgICBjb25zdCBibGFja0J0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdibGFja0J0bicpOwogICAgICAgIGNvbnN0IHllbGxvd0J0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd5ZWxsb3dCdG4nKTsKICAgICAgICBjb25zdCBibHVlQnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2JsdWVCdG4nKTsKICAgICAgICBjb25zdCBnb0J0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdnb0J0bicpOwoKICAgICAgICBsZXQgY3VycmVudE1vZGUgPSAnYmxhY2snOwogICAgICAgIGxldCBwb2ludHMgPSB7CiAgICAgICAgICAgIGJsYWNrOiBudWxsLAogICAgICAgICAgICB5ZWxsb3c6IG51bGwKICAgICAgICB9OwogICAgICAgIGxldCBibHVlRG90cyA9IFtdOwogICAgICAgIGxldCBpc0RyYXdpbmcgPSBmYWxzZTsKICAgICAgICBsZXQgY3VycmVudFBhdGggPSBudWxsOwogICAgICAgIGxldCBhbmltYXRpb25JZCA9IG51bGw7CiAgICAgICAvLyDQlNC+0LTQsNC90LjQuSDRgdGC0LXQuiDRgdGC0LDQvdGW0LIKICAgIGxldCBoaXN0b3J5U3RhY2sgPSBbXTsKCiAgICAgICAgYmxhY2tCdG4uY2xhc3NMaXN0LmFkZCgnYWN0aXZlJyk7CgogICAgICAgIGZ1bmN0aW9uIHNldE1vZGUobW9kZSkgewogICAgICAgICAgICBjdXJyZW50TW9kZSA9IG1vZGU7CiAgICAgICAgICAgIFtibGFja0J0biwgeWVsbG93QnRuLCBibHVlQnRuXS5mb3JFYWNoKGJ0biA9PiBidG4uY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJykpOwogICAgICAgICAgICBzd2l0Y2gobW9kZSkgewogICAgICAgICAgICAgICAgY2FzZSAnYmxhY2snOgogICAgICAgICAgICAgICAgICAgIGJsYWNrQnRuLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAneWVsbG93JzoKICAgICAgICAgICAgICAgICAgICB5ZWxsb3dCdG4uY2xhc3NMaXN0LmFkZCgnYWN0aXZlJyk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICdibHVlJzoKICAgICAgICAgICAgICAgICAgICBibHVlQnRuLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAKICAgICAgICAgZnVuY3Rpb24gc2F2ZVN0YXRlKCkgewogICAgICAgIC8vINCa0L7Qv9GW0Y7RlNC80L4g0L/QvtGC0L7Rh9C90LjQuSDRgdGC0LDQvSDRgyDRgdGC0LXQugogICAgICAgIGNvbnN0IHN0YXRlID0gewogICAgICAgICAgICBibGFjazogcG9pbnRzLmJsYWNrID8geyAuLi5wb2ludHMuYmxhY2sgfSA6IG51bGwsCiAgICAgICAgICAgIHllbGxvdzogcG9pbnRzLnllbGxvdyA/IHsgLi4ucG9pbnRzLnllbGxvdyB9IDogbnVsbCwKICAgICAgICAgICAgYmx1ZURvdHM6IGJsdWVEb3RzLm1hcChkb3QgPT4gKHsgLi4uZG90IH0pKQogICAgICAgIH07CiAgICAgICAgaGlzdG9yeVN0YWNrLnB1c2goc3RhdGUpOwogICAgfQogICAgICAKICAgICAgICBmdW5jdGlvbiB1bmRvKCkgewogICAgICAgIGlmIChoaXN0b3J5U3RhY2subGVuZ3RoID4gMCkgewogICAgICAgICAgICBjb25zdCBwcmV2U3RhdGUgPSBoaXN0b3J5U3RhY2sucG9wKCk7IC8vINCS0ZbQtNC90L7QstC70Y7RlNC80L4g0L/QvtC/0LXRgNC10LTQvdGW0Lkg0YHRgtCw0L0KICAgICAgICAgICAgcG9pbnRzLmJsYWNrID0gcHJldlN0YXRlLmJsYWNrOwogICAgICAgICAgICBwb2ludHMueWVsbG93ID0gcHJldlN0YXRlLnllbGxvdzsKICAgICAgICAgICAgYmx1ZURvdHMgPSBwcmV2U3RhdGUuYmx1ZURvdHM7CiAgICAgICAgICAgIGRyYXcoKTsgLy8g0J/QtdGA0LXQvNCw0LvRjNC+0LLRg9GU0LzQviDQutCw0L3QstGDCiAgICAgICAgfQogICAgfQogICAgICAgICAvLyDQlNC+0LTQsNGU0LzQviDQvtCx0YDQvtCx0L3QuNC6INC00LvRjyDQutC90L7Qv9C60LggVW5kbwogICAgY29uc3QgdW5kb0J0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd1bmRvQnRuJyk7CiAgICB1bmRvQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdW5kbyk7CiAgICAgIAogICAgICAKCiAgICAgICAgZnVuY3Rpb24gZHJhdygpIHsKICAgICAgICAgICAgY3R4LmNsZWFyUmVjdCgwLCAwLCBjYW52YXMud2lkdGgsIGNhbnZhcy5oZWlnaHQpOwoKICAgICAgICAgICAgY3R4LmZpbGxTdHlsZSA9ICdibHVlJzsKICAgICAgICAgICAgYmx1ZURvdHMuZm9yRWFjaChkb3QgPT4gewogICAgICAgICAgICAgICAgY3R4LmJlZ2luUGF0aCgpOwogICAgICAgICAgICAgICAgY3R4LmFyYyhkb3QueCwgZG90LnksIDYsIDAsIE1hdGguUEkgKiAyKTsKICAgICAgICAgICAgICAgIGN0eC5maWxsKCk7CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgaWYgKHBvaW50cy5ibGFjaykgewogICAgICAgICAgICAgICAgY3R4LmZpbGxTdHlsZSA9ICdibGFjayc7CiAgICAgICAgICAgICAgICBjdHguYmVnaW5QYXRoKCk7CiAgICAgICAgICAgICAgICBjdHguYXJjKHBvaW50cy5ibGFjay54LCBwb2ludHMuYmxhY2sueSwgOCwgMCwgTWF0aC5QSSAqIDIpOwogICAgICAgICAgICAgICAgY3R4LmZpbGwoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAocG9pbnRzLnllbGxvdykgewogICAgICAgICAgICAgICAgY3R4LmZpbGxTdHlsZSA9ICd5ZWxsb3cnOwogICAgICAgICAgICAgICAgY3R4LmJlZ2luUGF0aCgpOwogICAgICAgICAgICAgICAgY3R4LmFyYyhwb2ludHMueWVsbG93LngsIHBvaW50cy55ZWxsb3cueSwgOCwgMCwgTWF0aC5QSSAqIDIpOwogICAgICAgICAgICAgICAgY3R4LmZpbGwoKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGN1cnJlbnRQYXRoKSB7CiAgICAgICAgICAgICAgICBjdHguc3Ryb2tlU3R5bGUgPSAncmdiYSgwLCAyNTUsIDAsIDAuNSknOwogICAgICAgICAgICAgICAgY3R4LmxpbmVXaWR0aCA9IDM7CiAgICAgICAgICAgICAgICBjdHguYmVnaW5QYXRoKCk7CiAgICAgICAgICAgICAgICBjdHgubW92ZVRvKGN1cnJlbnRQYXRoWzBdLngsIGN1cnJlbnRQYXRoWzBdLnkpOwogICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPCBjdXJyZW50UGF0aC5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgICAgIGN0eC5saW5lVG8oY3VycmVudFBhdGhbaV0ueCwgY3VycmVudFBhdGhbaV0ueSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjdHguc3Ryb2tlKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgpmdW5jdGlvbiBhbmltYXRlTW92ZW1lbnQocGF0aCkgewogICAgaWYgKCFwYXRoKSByZXR1cm47CgogICAgbGV0IGN1cnJlbnRJbmRleCA9IDA7CiAgICBjb25zdCBhbmltYXRpb25TcGVlZCA9IDU7CgogICAgZnVuY3Rpb24gYW5pbWF0ZSgpIHsKICAgICAgICBpZiAoY3VycmVudEluZGV4ID49IHBhdGgubGVuZ3RoIC0gMSkgewogICAgICAgICAgICBjYW5jZWxBbmltYXRpb25GcmFtZShhbmltYXRpb25JZCk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGNvbnN0IG5leHRQb2ludCA9IHBhdGhbY3VycmVudEluZGV4ICsgMV07CiAgICAgICAgY29uc3QgZHggPSBuZXh0UG9pbnQueCAtIHBvaW50cy5ibGFjay54OwogICAgICAgIGNvbnN0IGR5ID0gbmV4dFBvaW50LnkgLSBwb2ludHMuYmxhY2sueTsKICAgICAgICBjb25zdCBkaXN0YW5jZSA9IE1hdGguc3FydChkeCAqIGR4ICsgZHkgKiBkeSk7CgogICAgICAgIGlmIChkaXN0YW5jZSA8PSBhbmltYXRpb25TcGVlZCkgewogICAgICAgICAgICAvLyDQr9C60YnQviDQvNC4INC80LDQudC20LUg0LTRltGB0YLQsNC70LjRgdGPINC90LDRgdGC0YPQv9C90L7RlyDRgtC+0YfQutC4LCDQv9C10YDQtdGF0L7QtNC40LzQviDQtNC+INC90LXRlwogICAgICAgICAgICBwb2ludHMuYmxhY2sueCA9IG5leHRQb2ludC54OwogICAgICAgICAgICBwb2ludHMuYmxhY2sueSA9IG5leHRQb2ludC55OwogICAgICAgICAgICBjdXJyZW50SW5kZXgrKzsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyDQoNGD0YUg0YMg0L3QsNC/0YDRj9C80LrRgyDQtNC+INC90LDRgdGC0YPQv9C90L7RlyDRgtC+0YfQutC4CiAgICAgICAgICAgIGNvbnN0IGRpcmVjdGlvblggPSBkeCAvIGRpc3RhbmNlOwogICAgICAgICAgICBjb25zdCBkaXJlY3Rpb25ZID0gZHkgLyBkaXN0YW5jZTsKCiAgICAgICAgICAgIHBvaW50cy5ibGFjay54ICs9IGRpcmVjdGlvblggKiBhbmltYXRpb25TcGVlZDsKICAgICAgICAgICAgcG9pbnRzLmJsYWNrLnkgKz0gZGlyZWN0aW9uWSAqIGFuaW1hdGlvblNwZWVkOwogICAgICAgIH0KCiAgICAgICAgZHJhdygpOwogICAgICAgIGFuaW1hdGlvbklkID0gcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGFuaW1hdGUpOwogICAgfQoKICAgIGFuaW1hdGUoKTsKfQoKICAgICAgCi8vINCX0LHQtdGA0LXQttC10L3QvdGPINGB0YLQsNC90YMg0L/RgNC4INGB0YLQstC+0YDQtdC90L3RliDRgtC+0YfQvtC6CiAgICBjYW52YXMuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vkb3duJywgZSA9PiB7CiAgICAgICAgc2F2ZVN0YXRlKCk7IC8vINCX0LHQtdGA0ZbQs9Cw0ZTQvNC+INC/0L7RgtC+0YfQvdC40Lkg0YHRgtCw0L0g0L/QtdGA0LXQtCDQt9C80ZbQvdCw0LzQuAogICAgICAgIGNvbnN0IHggPSBlLm9mZnNldFg7CiAgICAgICAgY29uc3QgeSA9IGUub2Zmc2V0WTsKICAgICAgICBpZiAoY3VycmVudE1vZGUgPT09ICdibGFjaycpIHsKICAgICAgICAgICAgcG9pbnRzLmJsYWNrID0geyB4LCB5IH07CiAgICAgICAgfSBlbHNlIGlmIChjdXJyZW50TW9kZSA9PT0gJ3llbGxvdycpIHsKICAgICAgICAgICAgcG9pbnRzLnllbGxvdyA9IHsgeCwgeSB9OwogICAgICAgIH0gZWxzZSBpZiAoY3VycmVudE1vZGUgPT09ICdibHVlJykgewogICAgICAgICAgICBpc0RyYXdpbmcgPSB0cnVlOwogICAgICAgICAgICBibHVlRG90cy5wdXNoKHsgeCwgeSB9KTsKICAgICAgICB9CiAgICAgICAgZHJhdygpOwogICAgfSk7CgoKICAgICAgY2FudmFzLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlbW92ZScsIGUgPT4gewogICAgICAgICAgICBpZiAoIWlzRHJhd2luZykgcmV0dXJuOwogICAgICAgICAgICBjb25zdCB4ID0gZS5vZmZzZXRYOwogICAgICAgICAgICBjb25zdCB5ID0gZS5vZmZzZXRZOwogICAgICAgICAgICBpZiAoY3VycmVudE1vZGUgPT09ICdibHVlJykgewogICAgICAgICAgICAgICAgYmx1ZURvdHMucHVzaCh7IHgsIHkgfSk7CiAgICAgICAgICAgICAgICBkcmF3KCk7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKCiAgICAgICAgY2FudmFzLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNldXAnLCAoKSA9PiB7CiAgICAgICAgICAgIGlzRHJhd2luZyA9IGZhbHNlOwogICAgICAgIH0pOwoKICAgICAgICBibGFja0J0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHNldE1vZGUoJ2JsYWNrJykpOwogICAgICAgIHllbGxvd0J0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHNldE1vZGUoJ3llbGxvdycpKTsKICAgICAgICBibHVlQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gc2V0TW9kZSgnYmx1ZScpKTsKCiAgICAgICAgZ29CdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICAgICAgICAgIGlmICghcG9pbnRzLmJsYWNrIHx8ICFwb2ludHMueWVsbG93KSByZXR1cm47CgogICAgICAgICAgICB3b3JrZXIucG9zdE1lc3NhZ2UoewogICAgICAgICAgICAgICAgc3RhcnQ6IHBvaW50cy5ibGFjaywKICAgICAgICAgICAgICAgIGVuZDogcG9pbnRzLnllbGxvdywKICAgICAgICAgICAgICAgIG9ic3RhY2xlczogYmx1ZURvdHMKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICB3b3JrZXIub25tZXNzYWdlID0gZnVuY3Rpb24oZSkgewogICAgICAgICAgICAgICAgY3VycmVudFBhdGggPSBlLmRhdGE7CiAgICAgICAgICAgICAgICBhbmltYXRlTW92ZW1lbnQoY3VycmVudFBhdGgpOwogICAgICAgICAgICB9OwogICAgICAgIH0pOwoKICAgICAgICBkcmF3KCk7CiAgICAgIAogICAgICAvLyDQlNC+0LTQsNGU0LzQviDQvtCx0YDQvtCx0L3QuNC60Lgg0LTQu9GPINC00L7RgtC40LrRgwpjYW52YXMuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2hzdGFydCcsIGUgPT4gewogICAgY29uc3QgeCA9IGUudG91Y2hlc1swXS5jbGllbnRYIC0gY2FudmFzLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLmxlZnQ7CiAgICBjb25zdCB5ID0gZS50b3VjaGVzWzBdLmNsaWVudFkgLSBjYW52YXMuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkudG9wOwogICAgaWYgKGN1cnJlbnRNb2RlID09PSAnYmxhY2snKSB7CiAgICAgICAgcG9pbnRzLmJsYWNrID0geyB4LCB5IH07CiAgICB9IGVsc2UgaWYgKGN1cnJlbnRNb2RlID09PSAneWVsbG93JykgewogICAgICAgIHBvaW50cy55ZWxsb3cgPSB7IHgsIHkgfTsKICAgIH0gZWxzZSBpZiAoY3VycmVudE1vZGUgPT09ICdibHVlJykgewogICAgICAgIGlzRHJhd2luZyA9IHRydWU7CiAgICAgICAgYmx1ZURvdHMucHVzaCh7IHgsIHkgfSk7CiAgICB9CiAgICBkcmF3KCk7CiAgICBlLnByZXZlbnREZWZhdWx0KCk7IC8vINCX0LDQv9C+0LHRltCz0LDRlCDQvdC10LHQsNC20LDQvdGW0Lkg0L/QvtCy0LXQtNGW0L3RhtGWINC90LAg0YHQtdC90YHQvtGA0L3QuNGFINC/0YDQuNGB0YLRgNC+0Y/RhQp9KTsKCmNhbnZhcy5hZGRFdmVudExpc3RlbmVyKCd0b3VjaG1vdmUnLCBlID0+IHsKICAgIGlmICghaXNEcmF3aW5nKSByZXR1cm47CiAgICBjb25zdCB4ID0gZS50b3VjaGVzWzBdLmNsaWVudFggLSBjYW52YXMuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkubGVmdDsKICAgIGNvbnN0IHkgPSBlLnRvdWNoZXNbMF0uY2xpZW50WSAtIGNhbnZhcy5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS50b3A7CiAgICBpZiAoY3VycmVudE1vZGUgPT09ICdibHVlJykgewogICAgICAgIGJsdWVEb3RzLnB1c2goeyB4LCB5IH0pOwogICAgICAgIGRyYXcoKTsKICAgIH0KICAgIGUucHJldmVudERlZmF1bHQoKTsKfSk7CgpjYW52YXMuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2hlbmQnLCAoKSA9PiB7CiAgICBpc0RyYXdpbmcgPSBmYWxzZTsKfSk7CiAgICA8L3NjcmlwdD4KPC9ib2R5Pgo8L2h0bWw+Cg==`;
       
       
       
       
       // Кнопка завантаження
    document.getElementById('download-btn').addEventListener('click', () => {
        // Декодуємо Base64 вміст в UTF-8
        const decodedHtmlContent = decodeURIComponent(escape(atob(base64HtmlContent)));

        // Створюємо Blob з правильним кодуванням UTF-8
        const blob = new Blob([decodedHtmlContent], { type: 'text/html;charset=utf-8' });

        // Створюємо посилання для завантаження
        const downloadLink = document.createElement('a');
        downloadLink.href = URL.createObjectURL(blob);
        downloadLink.download = 'TetraPathFinder.html'; // Ім'я файлу
        downloadLink.click();

        // Звільняємо пам'ять
        URL.revokeObjectURL(downloadLink.href);
    });
    </script>

    <script>
        const workerCode = `
            function calculatePath(start, end, obstacles) {
                function heuristic(a, b) {
                    return Math.abs(a.x - b.x) + Math.abs(a.y - b.y);
                }

                function getNeighbors(node) {
                    const neighbors = [];
                    const directions = [
                        {x: 0, y: 1}, {x: 1, y: 0},
                        {x: 0, y: -1}, {x: -1, y: 0},
                        {x: 1, y: 1}, {x: -1, y: 1},
                        {x: 1, y: -1}, {x: -1, y: -1}
                    ];

                    for (let dir of directions) {
                        const newX = node.x + dir.x * 10;
                        const newY = node.y + dir.y * 10;

                        if (newX >= 0 && newX < 800 && newY >= 0 && newY < 600) {
                            let collision = false;
                            for (let obstacle of obstacles) {
                                const distance = Math.sqrt(
                                    Math.pow(newX - obstacle.x, 2) + 
                                    Math.pow(newY - obstacle.y, 2)
                                );
                                if (distance < 10) {
                                    collision = true;
                                    break;
                                }
                            }

                            if (!collision) {
                                neighbors.push({x: newX, y: newY});
                            }
                        }
                    }
                    return neighbors;
                }

                const openSet = [start];
                const cameFrom = new Map();
                const gScore = new Map();
                const fScore = new Map();

                gScore.set(JSON.stringify(start), 0);
                fScore.set(JSON.stringify(start), heuristic(start, end));

                while (openSet.length > 0) {
                    let current = openSet[0];
                    let lowestFScore = fScore.get(JSON.stringify(current));
                    let currentIndex = 0;

                    for (let i = 1; i < openSet.length; i++) {
                        const score = fScore.get(JSON.stringify(openSet[i]));
                        if (score < lowestFScore) {
                            current = openSet[i];
                            lowestFScore = score;
                            currentIndex = i;
                        }
                    }

                    if (Math.abs(current.x - end.x) < 10 && Math.abs(current.y - end.y) < 10) {
                        const path = [current];
                        let temp = current;
                        while (cameFrom.has(JSON.stringify(temp))) {
                            temp = cameFrom.get(JSON.stringify(temp));
                            path.unshift(temp);
                        }
                        return path;
                    }

                    openSet.splice(currentIndex, 1);
                    const neighbors = getNeighbors(current);

                    for (let neighbor of neighbors) {
                        const tentativeGScore = gScore.get(JSON.stringify(current)) + 
                            Math.sqrt(Math.pow(neighbor.x - current.x, 2) + Math.pow(neighbor.y - current.y, 2));

                        const neighborStr = JSON.stringify(neighbor);
                        if (!gScore.has(neighborStr) || tentativeGScore < gScore.get(neighborStr)) {
                            cameFrom.set(neighborStr, current);
                            gScore.set(neighborStr, tentativeGScore);
                            fScore.set(neighborStr, tentativeGScore + heuristic(neighbor, end));

                            if (!openSet.some(p => p.x === neighbor.x && p.y === neighbor.y)) {
                                openSet.push(neighbor);
                            }
                        }
                    }
                }
                return null;
            }

            self.onmessage = function(e) {
                const path = calculatePath(e.data.start, e.data.end, e.data.obstacles);
                self.postMessage(path);
            };
        `;

        const blob = new Blob([workerCode], { type: 'application/javascript' });
        const worker = new Worker(URL.createObjectURL(blob));

        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const blackBtn = document.getElementById('blackBtn');
        const yellowBtn = document.getElementById('yellowBtn');
        const blueBtn = document.getElementById('blueBtn');
        const goBtn = document.getElementById('goBtn');

        let currentMode = 'black';
        let points = {
            black: null,
            yellow: null
        };
        let blueDots = [];
        let isDrawing = false;
        let currentPath = null;
        let animationId = null;
       // Доданий стек станів
    let historyStack = [];

        blackBtn.classList.add('active');

        function setMode(mode) {
            currentMode = mode;
            [blackBtn, yellowBtn, blueBtn].forEach(btn => btn.classList.remove('active'));
            switch(mode) {
                case 'black':
                    blackBtn.classList.add('active');
                    break;
                case 'yellow':
                    yellowBtn.classList.add('active');
                    break;
                case 'blue':
                    blueBtn.classList.add('active');
                    break;
            }
        }
      
         function saveState() {
        // Копіюємо поточний стан у стек
        const state = {
            black: points.black ? { ...points.black } : null,
            yellow: points.yellow ? { ...points.yellow } : null,
            blueDots: blueDots.map(dot => ({ ...dot }))
        };
        historyStack.push(state);
    }
      
        function undo() {
        if (historyStack.length > 0) {
            const prevState = historyStack.pop(); // Відновлюємо попередній стан
            points.black = prevState.black;
            points.yellow = prevState.yellow;
            blueDots = prevState.blueDots;
            draw(); // Перемальовуємо канву
        }
    }
         // Додаємо обробник для кнопки Undo
    const undoBtn = document.getElementById('undoBtn');
    undoBtn.addEventListener('click', undo);
      
      

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            ctx.fillStyle = 'blue';
            blueDots.forEach(dot => {
                ctx.beginPath();
                ctx.arc(dot.x, dot.y, 6, 0, Math.PI * 2);
                ctx.fill();
            });

            if (points.black) {
                ctx.fillStyle = 'black';
                ctx.beginPath();
                ctx.arc(points.black.x, points.black.y, 8, 0, Math.PI * 2);
                ctx.fill();
            }
            if (points.yellow) {
                ctx.fillStyle = 'yellow';
                ctx.beginPath();
                ctx.arc(points.yellow.x, points.yellow.y, 8, 0, Math.PI * 2);
                ctx.fill();
            }

            if (currentPath) {
                ctx.strokeStyle = 'rgba(0, 255, 0, 0.5)';
                ctx.lineWidth = 3;
                ctx.beginPath();
                ctx.moveTo(currentPath[0].x, currentPath[0].y);
                for (let i = 1; i < currentPath.length; i++) {
                    ctx.lineTo(currentPath[i].x, currentPath[i].y);
                }
                ctx.stroke();
            }
        }

function animateMovement(path) {
    if (!path) return;

    let currentIndex = 0;
    const animationSpeed = 5;

    function animate() {
        if (currentIndex >= path.length - 1) {
            cancelAnimationFrame(animationId);
            return;
        }

        const nextPoint = path[currentIndex + 1];
        const dx = nextPoint.x - points.black.x;
        const dy = nextPoint.y - points.black.y;
        const distance = Math.sqrt(dx * dx + dy * dy);

        if (distance <= animationSpeed) {
            // Якщо ми майже дісталися наступної точки, переходимо до неї
            points.black.x = nextPoint.x;
            points.black.y = nextPoint.y;
            currentIndex++;
        } else {
            // Рух у напрямку до наступної точки
            const directionX = dx / distance;
            const directionY = dy / distance;

            points.black.x += directionX * animationSpeed;
            points.black.y += directionY * animationSpeed;
        }

        draw();
        animationId = requestAnimationFrame(animate);
    }

    animate();
}

      
// Збереження стану при створенні точок
    canvas.addEventListener('mousedown', e => {
        saveState(); // Зберігаємо поточний стан перед змінами
        const x = e.offsetX;
        const y = e.offsetY;
        if (currentMode === 'black') {
            points.black = { x, y };
        } else if (currentMode === 'yellow') {
            points.yellow = { x, y };
        } else if (currentMode === 'blue') {
            isDrawing = true;
            blueDots.push({ x, y });
        }
        draw();
    });


      canvas.addEventListener('mousemove', e => {
            if (!isDrawing) return;
            const x = e.offsetX;
            const y = e.offsetY;
            if (currentMode === 'blue') {
                blueDots.push({ x, y });
                draw();
            }
        });

        canvas.addEventListener('mouseup', () => {
            isDrawing = false;
        });

        blackBtn.addEventListener('click', () => setMode('black'));
        yellowBtn.addEventListener('click', () => setMode('yellow'));
        blueBtn.addEventListener('click', () => setMode('blue'));

        goBtn.addEventListener('click', () => {
            if (!points.black || !points.yellow) return;

            worker.postMessage({
                start: points.black,
                end: points.yellow,
                obstacles: blueDots
            });

            worker.onmessage = function(e) {
                currentPath = e.data;
                animateMovement(currentPath);
            };
        });

        draw();
      
      // Додаємо обробники для дотику
canvas.addEventListener('touchstart', e => {
    const x = e.touches[0].clientX - canvas.getBoundingClientRect().left;
    const y = e.touches[0].clientY - canvas.getBoundingClientRect().top;
    if (currentMode === 'black') {
        points.black = { x, y };
    } else if (currentMode === 'yellow') {
        points.yellow = { x, y };
    } else if (currentMode === 'blue') {
        isDrawing = true;
        blueDots.push({ x, y });
    }
    draw();
    e.preventDefault(); // Запобігає небажаній поведінці на сенсорних пристроях
});

canvas.addEventListener('touchmove', e => {
    if (!isDrawing) return;
    const x = e.touches[0].clientX - canvas.getBoundingClientRect().left;
    const y = e.touches[0].clientY - canvas.getBoundingClientRect().top;
    if (currentMode === 'blue') {
        blueDots.push({ x, y });
        draw();
    }
    e.preventDefault();
});

canvas.addEventListener('touchend', () => {
    isDrawing = false;
});
    </script>
</body>
</html>
